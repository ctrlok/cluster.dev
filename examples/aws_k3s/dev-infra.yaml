name: aws-backend
kind: backend
provider: s3
spec:
  bucket: {{ .project.variables.state_bucket_name }}
  region: {{ .project.variables.region }}
---
name: my-k3s-cluster
template: https://github.com/shalb/cdev-aws-k3s?ref=v0.0.1-rc2
kind: infrastructure
backend: aws-backend
variables:
  bucket: {{ .project.variables.state_bucket_name }}
  region: {{ .project.variables.region }}
  organization: {{ .project.variables.organization }}
  domain: cluster.dev
  instance_type: "t3.medium"
  k3s_version: "1.20.5+k3s1"
  # If you want to use existents VPC and subnets, uncomment options below, and set correct VPC id and subnets ids.
  # Otherwise, the new VPC and subnets will be created automatically.
  # vpc_id: "vpc-*****"
  # public_subnets:
  #   - "subnet-*****"
  #   - "subnet-*****"
  env: "dev"
  azs:
    - "{{ .project.variables.region }}a"
    - "{{ .project.variables.region }}b"
  public_key: "ssh-rsa AAAAB3NzaC1yc2EA......" # Set your public key here.  public_key_name: arti
  master_node_count: 1
  worker_node_groups:
    - name: "node_pool"
      min_size: 2
      max_size: 3
      instance_type: "t3.medium"
  argocdServerAdminPassword: "$2a$10$1buVsK9yv0Al1oJlLmABeeRxYsArdlT2QPdNRqaZwiuYztj9JUDmu" # This is bcrypted "password" for test only. Change this. For bcrypt your own password you could use this online tool: https://www.browserling.com/tools/bcrypt
