modules:
  - name: domain
    type: terraform
    source: github.com/shalb/cluster.dev//terraform/digitalocean/domain?ref=new-reconciler
    inputs:
      region: {{ .variables.region }}
      cluster_name: {{ .name }}
      cluster_domain: {{ .variables.domain }}
      zone_delegation: {{ if eq .variables.domain "cluster.dev" }}true{{ else }}false{{ end }}
  - name: vpc
    type: terraform
    source: github.com/shalb/cluster.dev//terraform/digitalocean/vpc?ref=new-reconciler
    inputs:
      region: {{ .variables.region }}
      cluster_name: {{ .name }}
  - name: k8s
    type: terraform
    source: github.com/shalb/cluster.dev//terraform/digitalocean/k8s?ref=new-reconciler
    depends_on: this.vpc
    inputs:
      cluster_name: {{ .name }}
      region: {{ .variables.region }}
      k8s_version: {{ .variables.k8s_version }}
      node_type: "s-1vcpu-2gb"
      min_node_count: 1
      max_node_count: 2
