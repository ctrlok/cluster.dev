name: aws-backend
kind: backend
provider: s3
spec:
  bucket: {{ .project.variables.state_bucket_name }}
  region: {{ .project.variables.region }}
---
name: k3s-infra
template: "template/aws-k3s.yaml"
kind: infrastructure
backend: aws-backend
variables:
  bucket: {{ .project.variables.state_bucket_name }}
  region: {{ .project.variables.region }}
  organization: {{ .project.variables.organization }}
  domain: /{ .domain }/
  instance_type: "t3.medium"
  env: "example"
  azs:
    - "{{ .project.variables.region }}a"
  public_key: "ssh-rsa AAAAB3..."
  public_key_name: example
  worker_node_groups:
    - name: "node_pool"
      min_size: 1
      max_size: 1
      instance_type: "t3.medium"