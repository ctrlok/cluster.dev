
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://cluster.dev/template-development/">
      
      <link rel="icon" href="../images/favicon.png">
      <meta name="generator" content="mkdocs-1.2, mkdocs-material-7.1.7">
    
    
      
        <title>Template Development - Cluster.dev</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.f1a3b89f.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-157259461-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#template-development" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cluster.dev" class="md-header__button md-logo" aria-label="Cluster.dev" data-md-component="logo">
      
  <img src="/images/cluster-dev-logo-small-white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cluster.dev
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Template Development
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/shalb/cluster.dev/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    shalb/cluster.dev
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../prerequisites/" class="md-tabs__link">
        Getting Started
      </a>
    </li>
  

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      Template Development
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../project-configuration/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cluster.dev" class="md-nav__button md-logo" aria-label="Cluster.dev" data-md-component="logo">
      
  <img src="/images/cluster-dev-logo-small-white.png" alt="logo">

    </a>
    Cluster.dev
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/shalb/cluster.dev/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    shalb/cluster.dev
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      <label class="md-nav__link" for="__nav_1">
        Home
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../documentation-structure/" class="md-nav__link">
        Documentation Structure
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Getting Started
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../prerequisites/" class="md-nav__link">
        cdev Prerequisites
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        cdev Install
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../aws-cloud-provider/" class="md-nav__link">
        Deploying to AWS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../digital-ocean-cloud-provider/" class="md-nav__link">
        Deploying to DigitalOcean
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../google-cloud-provider/" class="md-nav__link">
        Deploying to GCE
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../azure-cloud-provider/" class="md-nav__link">
        Deploying to Azure
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cdev-installation-reference/" class="md-nav__link">
        cdev Install Reference
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Template Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Template Development
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basics" class="md-nav__link">
    Basics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    Modules
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#terraform-module" class="md-nav__link">
    Terraform module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helm-module" class="md-nav__link">
    Helm module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-module" class="md-nav__link">
    Kubernetes module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#printer-module" class="md-nav__link">
    Printer module
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../project-configuration/" class="md-nav__link">
        Project Configuration
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      <label class="md-nav__link" for="__nav_4_2">
        CLI Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="CLI Reference" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          CLI Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cli-commands/" class="md-nav__link">
        CLI Commands
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cli-options/" class="md-nav__link">
        CLI Options
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basics" class="md-nav__link">
    Basics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    Modules
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#terraform-module" class="md-nav__link">
    Terraform module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helm-module" class="md-nav__link">
    Helm module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-module" class="md-nav__link">
    Kubernetes module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#printer-module" class="md-nav__link">
    Printer module
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/shalb/cluster.dev/edit/master/docs/template-development.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="template-development">Template Development<a class="headerlink" href="#template-development" title="Permanent link"> ¶</a></h1>
<h2 id="basics">Basics<a class="headerlink" href="#basics" title="Permanent link"> ¶</a></h2>
<p>A template is a directory, either local or located in a Git repo that contains template config files. cdev reads all ./*.yaml files from the directory (non-recursively), renders a template with the project's data, parse the yaml file and loads modules. Modules may contain reference to other files that are required for work. These files should be located inside the current directory (template context). As some of the files will also be rendered with the project's data, you can use Go-templates in them. For more details please see <a href="#modules">modules configuration</a> below.</p>
<p>Template represents a yaml structure with an array of different invocation modules. Common view:</p>
<div class="highlight"><pre><span></span><code><span class="nt">modules</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">module1</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">module2</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">module3</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p>Template can utilize all kinds of Go-templates and Sprig functions (similar to Helm). Along with that it is enhanced with functions like insertYAML that could pass yaml blocks directly.</p>
<h2 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link"> ¶</a></h2>
<p>1) <a href="https://golang.org/pkg/text/template/#hdr-Functions">Base Go-template language functions</a>.</p>
<p>2) <a href="https://masterminds.github.io/sprig/">Sprig functions</a>.</p>
<p>3) Enhanced functions: all functions described above allow you to modify the template text. Apart from these, some special enhanced functions are available. They cannot be used everywhere. The functions are integrated within the functionality of the program and with the yaml syntax:</p>
<ul>
<li><code>insertYAML</code> - pass yaml block as value of target yaml template. <strong>Argument</strong>: data to pass, any value or reference to block. <strong>Allowed use</strong>: only as full yaml value, in module <code>inputs</code>. Example:</li>
</ul>
<p>Source yaml:</p>
<div class="highlight"><pre><span></span><code><span class="nt">values</span><span class="p">:</span>
  <span class="nt">node_groups</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ng1</span>
      <span class="nt">min_size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">max_size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ng2</span>
      <span class="nt">max_size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">spot</span>
</code></pre></div>
<p>Target yaml template:</p>
<div class="highlight"><pre><span></span><code><span class="nt">modules</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">k3s</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">terraform</span>
    <span class="nt">node_groups</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">insertYAML .values.node_groups</span> <span class="p p-Indicator">}}</span>
</code></pre></div>
<p>Rendered template:</p>
<div class="highlight"><pre><span></span><code><span class="nt">modules</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">k3s</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">terraform</span>
    <span class="nt">node_groups</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ng1</span>
      <span class="nt">min_size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">max_size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ng2</span>
      <span class="nt">max_size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">spot</span>
</code></pre></div>
<ul>
<li>
<p><code>remoteState</code> - is used for passing data between modules and infrastructures, can be used in pre/post hooks. <strong>Argument</strong>: string, path to remote state consisting of 3 parts separated by a dot: <code>"infra_name.module_name.output_name"</code>. Since the name of the infrastructure is unknown inside the template, you can use "this" instead:<code>"this.module_name.output_name"</code>. <strong>Allowed use</strong>: </p>
<ul>
<li>
<p>all modules types: in <code>inputs</code>;</p>
</li>
<li>
<p>all modules types: in modules pre/post hooks;</p>
</li>
<li>
<p>in Kubernetes modules: in Kubernetes manifests.</p>
</li>
</ul>
</li>
<li>
<p><code>cidrSubnet</code> - calculates a subnet address within given IP network address prefix. Same as <a href="https://www.terraform.io/docs/language/functions/cidrsubnet.html">Terraform function</a>. Example:</p>
</li>
</ul>
<p>Source:
<div class="highlight"><pre><span></span><code><span class="o">{{</span> cidrSubnet <span class="s2">&quot;172.16.0.0/12&quot;</span> <span class="m">4</span> <span class="m">2</span> <span class="o">}}</span>
</code></pre></div>
Rendered:
<div class="highlight"><pre><span></span><code><span class="m">172</span>.18.0.0/16
</code></pre></div></p>
<h2 id="modules">Modules<a class="headerlink" href="#modules" title="Permanent link"> ¶</a></h2>
<p>All modules described below have a common format and common fields. Base example:</p>
<div class="highlight"><pre><span></span><code>  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">k3s</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">terraform</span>
    <span class="nt">depends_on</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">this.module1_name</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">this.module2_name</span>
<span class="c1">#   depends_on: this.module1_name # is allowed to use string for single, or list for multiple dependencies</span>
    <span class="nt">pre_hook</span><span class="p">:</span>
      <span class="nt">command</span><span class="p">:</span> <span class="s">&quot;echo</span><span class="nv"> </span><span class="s">pre_hook&quot;</span>
      <span class="c1"># script: &quot;./scripts/hook.sh&quot;</span>
      <span class="nt">on_apply</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">on_destroy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
      <span class="nt">on_plan</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">post_hook</span><span class="p">:</span>
      <span class="c1"># command: &quot;echo post_hook&quot;</span>
      <span class="nt">script</span><span class="p">:</span> <span class="s">&quot;./scripts/hook.sh&quot;</span>
      <span class="nt">on_apply</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">on_destroy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
      <span class="nt">on_plan</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>
<ul>
<li>
<p><code>name</code> - module name. <em>Required</em>.</p>
</li>
<li>
<p><code>type</code> - module type. One of: <code>terraform</code>, <code>helm</code>, <code>kubernetes</code>, <code>printer</code>. See below.</p>
</li>
<li>
<p><code>depends_on</code> - <em>string</em> or <em>list of strings</em>. One or multiple module dependencies in the format "infra_name.module_name". Since the name of the infrastructure is unknown inside the template, you can use "this" instead:<code>"this.module_name.output_name"</code>.</p>
</li>
<li>
<p><code>pre_hook</code> and <code>post_hook</code> blocks: describe the shell commands to be executed before and after the module, respectively. The commands will be executed in the same context as the actions of the module. Environment variables are common to the shell commands, the pre_hook and post_hook scripts, and the module execution. You can export a variable in the pre_hook and it will be available in the post_hook or in the module.</p>
<ul>
<li>
<p><code>command</code> - <em>string</em>. Shell command in text format. Will be executed in bash -c "command". Can be used if the "script" option is not used. One of <code>command</code> or <code>script</code> is required.</p>
</li>
<li>
<p><code>script</code> - <em>string</em> path to shell script file which is relative to template directory. Can be used if the "command" option is not used. One of <code>command</code> or <code>script</code> is required.</p>
</li>
<li>
<p><code>on_apply</code> <em>bool</em>, <em>optional</em> turn off/on when module applying. <strong>Default: "true"</strong>.</p>
</li>
<li>
<p><code>on_destroy</code> - <em>bool</em>, <em>optional</em> turn off/on when module destroying. <strong>Default: "false"</strong>.</p>
</li>
<li>
<p><code>on_plan</code> - <em>bool</em>, <em>optional</em> turn off/on when module plan executing. <strong>Default: "false"</strong>.</p>
</li>
</ul>
</li>
</ul>
<h3 id="terraform-module">Terraform module<a class="headerlink" href="#terraform-module" title="Permanent link"> ¶</a></h3>
<p>Describes direct Terraform module invocation.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">modules</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">vpc</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">terraform</span>
    <span class="nt">version</span><span class="p">:</span> <span class="s">&quot;2.77.0&quot;</span>
    <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">terraform-aws-modules/vpc/aws</span>
    <span class="nt">inputs</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">.name</span> <span class="p p-Indicator">}}</span>
      <span class="nt">azs</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">insertYAML .variables.azs</span> <span class="p p-Indicator">}}</span>
      <span class="nt">vpc_id</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">.variables.vpc_id</span> <span class="p p-Indicator">}}</span>
</code></pre></div>
<p>In addition to common options the following are available:</p>
<ul>
<li>
<p><code>source</code> - <em>string</em>, <em>required</em>. Terraform module <a href="https://www.terraform.io/docs/language/modules/syntax.html#source">source</a>. <strong>It is not allowed to use local folders in source!</strong></p>
</li>
<li>
<p><code>version</code> - <em>string</em>, <em>optional</em>. Module <a href="https://www.terraform.io/docs/language/modules/syntax.html#version">version</a>.</p>
</li>
<li>
<p><code>inputs</code> - <em>map of any</em>, <em>required</em>. A map that corresponds to <a href="https://www.terraform.io/docs/language/values/variables.html">input variables</a> defined by the module. This block allows to use functions <code>remoteState</code> and <code>insertYAML</code>.</p>
</li>
</ul>
<h3 id="helm-module">Helm module<a class="headerlink" href="#helm-module" title="Permanent link"> ¶</a></h3>
<p>Describes <a href="https://registry.terraform.io/providers/hashicorp/helm/latest/docs">Terraform Helm provider</a> invocation.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">modules</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">argocd</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">helm</span>
    <span class="nt">provider_version</span><span class="p">:</span> <span class="s">&quot;2.0.3&quot;</span>
    <span class="nt">source</span><span class="p">:</span>
      <span class="nt">repository</span><span class="p">:</span> <span class="s">&quot;https://argoproj.github.io/argo-helm&quot;</span>
      <span class="nt">chart</span><span class="p">:</span> <span class="s">&quot;argo-cd&quot;</span>
      <span class="nt">version</span><span class="p">:</span> <span class="s">&quot;2.11.0&quot;</span>
    <span class="nt">kubeconfig</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">../kubeconfig</span>
    <span class="nt">depends_on</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">this.k3s</span>
    <span class="nt">pre_hook</span><span class="p">:</span>
      <span class="nt">script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./scripts/get_kubeconfig.sh ./kubeconfig</span>
      <span class="nt">on_destroy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">on_plan</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">additional_options</span><span class="p">:</span>
      <span class="nt">namespace</span><span class="p">:</span> <span class="s">&quot;argocd&quot;</span>
      <span class="nt">create_namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">inputs</span><span class="p">:</span>
      <span class="nt">global.image.tag</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1.8.3</span>
      <span class="nt">service.type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</code></pre></div>
<p>In addition to common options the following are available:</p>
<ul>
<li>
<p><code>source</code> - <em>map</em>, <em>required</em>. Block describes Helm chart source.</p>
</li>
<li>
<p><code>chart</code>, <code>repository</code>, <code>version</code> - correspond to options with the same name from helm_release resource. See <a href="https://registry.terraform.io/providers/hashicorp/helm/latest/docs/resources/release#chart">chart</a>, <a href="https://registry.terraform.io/providers/hashicorp/helm/latest/docs/resources/release#repository">repository</a> and <a href="https://registry.terraform.io/providers/hashicorp/helm/latest/docs/resources/release#version">version</a>.</p>
</li>
<li>
<p><code>kubeconfig</code> - <em>string</em>, <em>required</em>. Path to the kubeconfig file which is relative to the directory where the module was executed.</p>
</li>
<li>
<p><code>provider_version</code> - <em>string</em>, <em>optional</em>. Version of terraform helm provider to use. Default - latest. See <a href="https://registry.terraform.io/providers/hashicorp/helm/latest">terraform helm provider</a>  </p>
</li>
<li>
<p><code>additional_options</code> - <em>map of any</em>, <em>optional</em>. Corresponds to <a href="https://registry.terraform.io/providers/hashicorp/helm/latest/docs/resources/release#argument-reference">Terraform helm_release resource options</a>. Will be passed as is.</p>
</li>
<li>
<p><code>inputs</code> - <em>map of any</em>, <em>optional</em>. A map that represents <a href="https://registry.terraform.io/providers/hashicorp/helm/latest/docs/resources/release#set">Terraform helm_release sets</a>. This block allows to use functions <code>remoteState</code> and <code>insertYAML</code>. For example:</p>
</li>
</ul>
<p><code>yaml
    inputs:
      global.image.tag: v1.8.3
      service.type: LoadBalancer</code></p>
<div class="codehilite"><pre><span></span><code>corresponds to:

```hcl
set {
  name = &quot;global.image.tag&quot;
  value = &quot;v1.8.3&quot;
}
set  {
  name = &quot;service.type&quot;
  value = &quot;LoadBalancer&quot;
}
```
</code></pre></div>

<h3 id="kubernetes-module">Kubernetes module<a class="headerlink" href="#kubernetes-module" title="Permanent link"> ¶</a></h3>
<p>Describes <a href="https://github.com/hashicorp/terraform-provider-kubernetes-alpha">Terraform kubernetes-alpha provider</a> invocation.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">modules</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">argocd_apps</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes</span>
    <span class="nt">provider_version</span><span class="p">:</span> <span class="s">&quot;0.2.1&quot;</span>
    <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./argocd-apps/app1.yaml</span>
    <span class="nt">kubeconfig</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">../kubeconfig</span>
    <span class="nt">depends_on</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">this.argocd</span>
</code></pre></div>
<ul>
<li>
<p><code>source</code> - <em>string</em>, <em>required</em>. Path to Kubernetes manifest that will be converted into a representation of kubernetes-alpha provider. <strong>Source file will be rendered with the template, and also allows to use the functions <code>remoteState</code> and <code>insertYAML</code></strong>.</p>
</li>
<li>
<p><code>kubeconfig</code> - <em>string</em>, <em>required</em>. Path to the kubeconfig file which is relative to the directory where the module was executed.</p>
</li>
<li><code>provider_version</code> - <em>string</em>, <em>optional</em>. Version of terraform kubernetes-alpha provider to use. Default - latest. See <a href="https://registry.terraform.io/providers/hashicorp/kubernetes-alpha/latest">terraform kubernetes-alpha provider</a> </li>
</ul>
<h3 id="printer-module">Printer module<a class="headerlink" href="#printer-module" title="Permanent link"> ¶</a></h3>
<p>The module is mainly used to see the outputs of other modules in the console logs.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">modules</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">print_outputs</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">printer</span>
    <span class="nt">inputs</span><span class="p">:</span>
      <span class="nt">cluster_name</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">.name</span> <span class="p p-Indicator">}}</span>
      <span class="nt">worker_iam_role_arn</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">remoteState &quot;this.eks.worker_iam_role_arn&quot;</span> <span class="p p-Indicator">}}</span>
</code></pre></div>
<ul>
<li><code>inputs</code> - <em>any</em>, <em>required</em> - a map that represents data to be printed in the log. The block <strong>allows to use the functions <code>remoteState</code> and <code>insertYAML</code></strong>.</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../cdev-installation-reference/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              cdev Install Reference
            </div>
          </div>
        </a>
      
      
        <a href="../project-configuration/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Project Configuration
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Project is maintained by
        <a href="https://www.shalb.com/" target="_blank" rel="noopener">
          SHALB
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://join.slack.com/t/cluster-dev/shared_invite/zt-eg4q6jae-v0~zgrBLYTTXt~CjnjmprA" target="_blank" rel="noopener" title="join.slack.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/shalbcom" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://github.com/shalb/cluster.dev" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.b0710199.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.76f349be.min.js"></script>
      
    
  </body>
</html>